# 22/10/21

## 상태 관리 방법 변화 과정

- 컴포넌트 개발 -> 어플리케이션 개발로 넘어오면서, 여러 개의 상태를 어떻게 관리할 지, 어떤 컴포넌트가 상태를 가져야 할 지 등 고민이 많아졌다.
- 어떤 문제를 겪고 어떤 방법으로 해결했는지, 그 방법에는 또 어떤 문제가 있었는지에 대한 과정을 기록해보자

### 지역 상태

- CBD 라이브러리
	- 루트 컴포넌트만이 상태를 가질 수 있었음

앱 규모가 커지고 컴포넌트 뎁스가 깊어지면서 지역 상태를 사용할 필요가 생김
- 하위 컴포넌트에서도 상태로 사용할 변수가 자연스럽게 생기는데, 그 모든 변수를 하나의 컴포넌트에서 가질 수 없음
	- 사용성하기 불편함
	- 관계없는 변수까지 하나로 묶임

문제 상황
- 상태가 바뀔 때 루트 이하 모든 컴포넌트가 새로운 인스턴스를 생성
- 인스턴스 프로퍼티로 상태를 유지하는 것이 불가능

두 가지 방법 고민
1. 인스턴스가 재생성되더라도 기존 상태를 유지할 수 있는 방법을 찾아내자
2. 부분 reconciliation이 가능하도록 렌더링 구조를 변경하자

첫번째 방법 선택. 이유는
1. 기존 구조를 바꾸지 않는 것이 정면돌파라고 생각
2. 리액트가 지역 상태를 어떻게 관리하는지 이해하고 적용해보자

1. 클로저를 이용한 지역 상태 관리
	- 상태를 생성하는 함수를 호출하면 컴포넌트 바깥에 상태를 두고 클로저로 값을 참조하는 방법
	- 전제 조건
		- 상태를 생성하는 함수가 항상 같은 순서로 실행되어야 한다.
		- 따라서, 조건문이나 반복문 안에서 상태를 생성하면 안된다
	- 한계
		- 상태 변경을 통해 렌더링이 일어나는 경우에만 상태 유지가 보장
			- 페이지 라우팅 문제
		- 함수형 / 클래스형이 뒤섞여 통일성이 깨짐

2. 부분 reconciliation을 통한 지역상태 유지
	- 상태를 변경한 컴포넌트의 자식만 리렌더링
	- 전제 조건
		- 상태를 바꾼 컴포넌트를 찾을 수 있어야 한다.
		- 따라서 컴포넌트를 무조건 하나의 요소로 감싸고, 래퍼 요소에 id를 부여한다
	- render함수 내부에서 조건에 따라 컨테이너와 컴포넌트를 다르게 설정하여 reconciliation

### 전역 상태

- 전역 상태: 컴포넌트 바깥에 존재하여 특정 컴포넌트에 종속적이지 않고, 필요한 곳에서 가져다 쓸 수 있는 상태
	- 앱 전체에 영향을 미치는 상태
- 지역 상태: 컴포넌트가 직접 소유하는 상태.
	- 컴포넌트 자신과 자식 컴포넌트에만 영향을 미치는 상태

루트에 있어야 하는 상태 === 전역상태!
- 상태가 루트에 존재한다 -> 앱 전체에 영향을 미친다 -> 컴포넌트 바깥으로 분리하여 사용성을 높이자!


아쉬운 점
- 일의 크기와 순서를 잘 생각하자
	- 개발 중간에 상태 관리 구조와 방법이 크게 바뀌면서 혼란이 생기고 시간이 많이 소모됐다. 큰 결정은 신중하게 해야지
- 코드가 미칠 영향을 꼼꼼하게 생각하자
	- 구조를 바꾸면서, 특히 라이브러리 코드를 수정하면서 예상치 못한 에러들이 쏟아져 나왔다. 함수 호출 순서, 인수 타입 등이 꼬여서 고생했다. 동작 원리를 정확히 이해하고 사용하자

1 페이지
상태 관리 선정 이유
- 컴포넌트 개발 -> 어플리케이션 개발로 넘어오면서, 여러 개의 상태를 어떻게 관리할 지, 어떤 컴포넌트가 상태를 가져야 할 지 등 고민이 많아졌다.
- 어떤 문제를 겪고 어떤 방법으로 해결했는지 경험을 공유해보자

지역 상태 / 전역 상태 간단하게 정의

2 페이지
지역 상태가 필요해진 이유

기존 구조 문제점

3페이지
해결 방안 제시

마지막
많이 돌아왔고 힘들었지만, 직접 문제를 겪어보면서 안되는 게 왜 안되는지를 안 것도 큰 경험이라고 생각함
