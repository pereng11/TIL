# 2022/08/12

## 스코프

- 식별자가 유효한 범위
    - 모든 식별자는 자신이 선언된 위치에 의해 스코프가 결정됨
        - 변수 이름, 함수 이름, 클래스 이름 등
    - 네임스페이스 역할
- 자바스크립트 엔진이 식별자를 결정하는 규칙
    - 이름이 같은 식별자가 존재할 경우 어떤 것을 참조해야 하는 지 결정해야 함
        - 이때 스코프를 통해 결정

- 렉시컬 환경
    - 스코프는 렉시컬 환경을 달리 부르는 논리적인 개념인가?
        - 같은 공간을 가리키는데 왜 용어를 구분했을까?
    - 코드의 문맥을 구성하는 환경
        - 코드가 어디서 실행되며, 주변에 어떤 코드가 있는지
        - 변수는 렉시컬 환경의 프로퍼티로 등록된다
    - 종류
        - 전역 렉시컬 환경
            - 코드가 로드되자 마자 생성
        - 함수의 렉시컬 환경
            - 함수가 **호출**될 때 생성
            

### 스코프의 종류

- 전역 스코프
    - 어디서든지 참조할 수 있음
- 지역 스코프
    - 지역의 범위
        - 함수 몸체(~ES5)
        - 블록문(ES6+ let/const)
    - 지역 변수는 자기 자신과 하위 지역 스코프에서 유효하다
        - 스코프 체인으로 이어진 하위 지역 스코프

### 스코프 체인

- 스코프가 함수의 중첩에 의해 계층적 구조로 연결된 것
- 실행 컨텍스트의 렉시컬 환경을 **단방향**으로 연결한 것
    - 모든 스코프는 아래 방향으로만 유효함
    - 상위 스코프에서 하위 스코프의 식별자를 참조할 수 없음
- 변수 검색을 위한 지도
    - 자바스크립트 엔진은 시작 스코프부터 상위로 거슬러 올라가며 변수를 검색한다
        1. 변수 참조를 시작한 스코프에서 검색 시작
            1. 변수가 스코프에 존재하면 검색 종료
            2. 없으면 상위 스코프로 이동
        2.  전역 스코프에서도 찾지 못하면 Reference Error
        
         
        

### 스코프 레벨

- 함수 레벨 스코프
    - 코드 블럭이 아닌 함수 몸체를 기준으로 생성된 스코프
    - var 키워드로 선언한 변수와 함수 선언문은 함수 레벨 스코프를 가진다
        
        ```jsx
        var b = 100;
        
        // if문이 실행되는 경우
        if (b < 1000) {
        	function test() {
        		console.log(123);
        		function inner() {
        			console.log('inner');
        		}
        	}
        }
        
        test(); // 123
        //if문 내부의 함수를 if문 밖에서 사용할 수 있음
        // 즉 함수 선언문으로 선언한 함수는 함수 레벨 스코프를 가짐
        
        inner(); // ReferenceError: inner is not defined
        // inner함수는 test함수 밖에서 호출 불가능
        
        // if문이 실행되는 경우
        if (b < 1000) {
        	let test = function test() {
        		console.log(123);
        		function inner() {
        			console.log('inner');
        		}
        	}
        }
        
        test(); // ReferenceError: test is not defined
        //if문 내부의 함수를 if문 밖에서 사용할 수 있음
        // 즉 함수 선언문으로 선언한 함수는 함수 레벨 스코프를 가짐
        ```
        
- 블록 레벨 스코프
    - 조건문, 반복문 등을 포함한 코드 블록을 기준으로 생성된 스코프
    - let / const 키워드로 선언한 변수는 블록 레벨 스코프를 가진다

### 렉시컬 스코프

- 동적 스코프 vs 렉시컬 스코프
    - 동적 스코프(dynamic scope)
        - 함수의 호출 위치에 따라 스코프를 결정하는 것
        - 같은 함수라도 호출 위치에 따라 스코프 체인이 달라짐
    - 렉시컬 스코프(lexical scope)
        - 함수의 정의 위치에 따라 스코프를 결정하는 것
        - 함수가 정의되는 시점에 상위 레벨 스코프를 기억함
- 자바스크립트는 정적 스코프를 따름
- 렉시컬 스코프 === 정적 스코프?
    - 용어에 대한 논의
        - 정적 스코프의 어원: 동적 스코프에 대한 대비를 위한 번역(static ↔ dynamic)
        - 그러나 렉시컬 스코프 또한 고정적이지 않기 때문에, 정적(static)이라는 용어는 부적절하다고 볼 수 있다
    - ‘렉시컬 스코프’용어를 사용하는 것 권장
        - 번역 이전 원어의 의미를 살리기 위해
        - 렉시컬 환경 등 같은 단어를 사용하는 용어와의 의미 관계를 명확하게 하기 위해